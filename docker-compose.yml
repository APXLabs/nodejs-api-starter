version: '3.1'

services:
  api:
    container_name: api
    build:
      context: .
      args:
        NODE_ENV: development
    hostname: api
    environment:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - PORT=5000
      - LISTEN_IP=0.0.0.0
      - MONGO_URI=mongodb://mongo:27017/app
    ports:
      - '5000:5000'
      - '127.0.0.1:9229:9229' # V8 inspector for debugging
    volumes:
      - yarn:/home/node/.cache/yarn
      - .:/opt/app:delegated
      - ./package.json:/opt/app/package.json
      - ./yarn.lock:/opt/app/yarn.lock
    command: ../node_modules/.bin/nodemon --inspect=0.0.0.0:9229 src/server.js
  mongo:
    container_name: mongo
    image: mongo:3.4.6
    ports:
      - 27017:27017
    environment:
      - MONGO_DATA_DIR=/data/db
      - MONGO_LOG_DIR=/dev/null
    command: mongod --smallfiles --logpath=/dev/null # --quiet
volumes:
  ? yarn
  ? notused
  ? mongo
